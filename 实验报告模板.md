## 《云计算技术》期末实验大作业报告

### 0. 基本信息

- **课程名称**：云计算技术
- **学期/班级**：2025年秋/23大数据2班
- **小组编号/组名**：
- **选题编号与题目**：A6 / 镜像构建
- **成员信息**：
  - 组长：潘丽娜-2361170060-分工 
  - 成员1：李梦君-2361170059-分工
  - 成员2：王露-236-分工
  - 成员3：潘婉钰-236-分工
- **完成日期**：2026-01-04
- **代码仓库地址**：`https://...`（如适用）

---

### 1. 摘要（200–300 字）

  本项目基于Ubuntu系统，使用Docker技术完成容器化应用部署。通过编写多阶段Dockerfile实现镜像瘦身，体积从895MB减少到158MB，优化率达82.3%。实现了端口映射、环境变量配置、卷挂载等功能，并通过脚本自动化验证了所有功能。项目体现了云计算的可复现、可验证、可解释原则。

---

### 2. 需求与目标

- **背景与问题描述**：学习Docker容器化技术，掌握镜像构建和容器管理
- **功能目标（必须项）**：
  - 目标1：编写Dockerfile构建镜像
  - 目标2：演示端口映射、环境变量、卷挂载
  - 目标3：实现版本标签管理
  - 目标4：镜像瘦身优化
- **性能/可靠性/安全目标（如有）**：镜像体积减少50%以上
- **不做的范围（明确边界）**：不涉及Kubernetes编排和云平台部署

---

### 3. 相关概念与原理

用自己的话说明与本项目最相关的概念（至少 3 点），并指出它们与项目实现的对应关系。

- 概念1（例如 NIST 云计算特征/服务模型）：容器化技术
  - 解释：将应用及其依赖打包成独立单元，实现环境一致性
  - 在本项目中的体现：使用Docker容器封装Flask应用
    
- 概念2（例如 虚拟化/容器/资源池化/可计量服务）：多阶段构建
  - 解释：使用多个FROM指令，前一阶段构建，后一阶段运行
  - 在本项目中的体现：Dockerfile分builder和runtime阶段
    
- 概念3（例如 OpenStack 组件/Neutron/Flavor/安全组/cloud-init）：镜像瘦身
  - 解释：通过Alpine基础镜像、删除缓存等方式减小镜像体积
  - 在本项目中的体现：从895MB优化到158MB

---

### 4. 实验环境与资源清单（可复现为第一原则）

#### 4.1 硬件与网络

- 机器数量：1台
- CPU/内存/磁盘：
- 网络环境（校园网/宿舍/实验室/是否需要 NAT）：NAT网络

#### 4.2 软件与版本

- 宿主机 OS：Windows
- 虚拟化软件（如 KVM/VirtualBox/VMware）：VMware
- 虚拟机OS：Ubuntu 24.04.3 LTS
- Docker 版本：28.5.1
- 其他依赖（数据库/语言运行时/镜像仓库等）：
    - Flask版本： 2.3.3
    - gunicorn版本： 20.1.0
    - requests版本： 2.31.0
    - python-dotenv版本： 1.0.0
    - FROM python:3.9-slim  # 基础镜像：包含Python 3.9 + Debian （Docker相关依赖）
    - FROM python:3.9-alpine # 最终镜像：Python 3.9 + Alpine Linux （Docker相关依赖）

---

### 5. 总体方案设计

#### 5.1 架构图/拓扑图
<img width="1215" height="1172" alt="a07dded2846fcfc6eb2bedc2ba6072bb" src="https://github.com/user-attachments/assets/58d1599a-30da-4dc0-bed2-524710caf35c" />

<img width="1284" height="474" alt="71833c0af72fee3830e79519a52173c5" src="https://github.com/user-attachments/assets/e1be5015-e903-4911-bce6-16cae25ae373" />

---

### 6. 实现过程（按步骤写清楚“做了什么 + 为什么这么做”）

> 建议按“准备 -> 创建资源 -> 配置 -> 验证 -> 优化”的结构书写。

#### 6.1 准备工作

- 关键前置条件检查：系统环境检查、Docker安装状态检查、网络连接检查
- 初始化命令/脚本（如有）：环境准备脚本setup-env.sh
  - 目录标准化：创建清晰的目录结构（src/app存放源码，data存放数据，report存放文档）便于项目管理
  - 环境隔离：为Docker项目创建独立的项目空间，避免与其他项目冲突

#### 6.2 核心步骤与命令清单

将关键命令集中列出，并配必要解释（不要只贴一堆截图）。

（示例结构）

- 步骤 1：创建多阶段Dockerfile
  - 命令：
  -     cd ~/cloud-final-project/src
  -     vim Dockerfile
  - 参数解释：
  -     USER appuser: 切换到非root用户运行，提高安全性
  - 输出/结果（截图/日志）：
    <img width="865" height="559" alt="image" src="https://github.com/user-attachments/assets/c058ff2b-b75b-48a5-a4a1-cdbf4edf39af" />

- 步骤 2：编写Flask应用
  - 命令：
  -     cd ~/cloud-final-project/src/app
  -     vim app.py
  - 参数解释：
  - @app.route('/health'): 健康检查端点，用于Docker健康检查
  - @app.route('/env'): 显示环境变量，验证容器配置
  - 输出/结果（截图/日志）：
    <img width="864" height="518" alt="image" src="https://github.com/user-attachments/assets/c2d72eea-17ae-4a1c-b0a9-3ed6e205d766" />

- 步骤 3：构建镜像
  - 命令：
  -     cd ~/cloud-final-project/src
  -     vim build.sh
  -     chmod +x build.sh
  -     ./build.sh
  - 参数解释：
  -    t cloud-final-demo:base: 指定镜像名称和标签
  -    -f Dockerfile.base: 指定使用的Dockerfile文件
  -    docker tag: 创建新的镜像标签
  - 输出/结果（截图/日志）：
  - <img width="864" height="364" alt="image" src="https://github.com/user-attachments/assets/72b35752-a32f-40c4-a637-6eb99dd045ea" />
    <img width="864" height="264" alt="image" src="https://github.com/user-attachments/assets/11c46763-44d9-4fb2-b193-7950a3841e6a" />
    <img width="864" height="149" alt="image" src="https://github.com/user-attachments/assets/2bd10e01-899d-468e-96bb-5b7ae2344122" />
    <img width="865" height="224" alt="image" src="https://github.com/user-attachments/assets/6013bdba-c046-4c53-887d-3b0083aa2878" />
    <img width="864" height="414" alt="image" src="https://github.com/user-attachments/assets/b5d09d97-e419-4103-be65-19accafc3d9a" />
    <img width="865" height="195" alt="image" src="https://github.com/user-attachments/assets/74baf473-dd39-4d60-98ef-3ce82255a99b" />
- 步骤 4：容器运行
  - 命令：
  -     cd ~/cloud-final-project/src
  -     vim run.sh
  -     chmod +x run.sh
  -     ./run.sh
  - 参数解释：
  - -p 8081:5000: 端口映射，主机8081映射到容器5000
  - -e FLASK_ENV=development: 设置环境变量
  - -v $(pwd)/../data/logs:/app/logs: 卷挂载，持久化日志
  - --name cloud-final-demo1: 指定容器名称
  - 输出/结果（截图/日志）：
  - <img width="865" height="458" alt="image" src="https://github.com/user-attachments/assets/60208ad4-1b98-46fe-894a-05b226a6a532" />
    <img width="864" height="399" alt="image" src="https://github.com/user-attachments/assets/687788e2-7375-43af-808a-2f01dbbf1c38" />
    <img width="864" height="218" alt="image" src="https://github.com/user-attachments/assets/530532de-0070-4095-82d4-48cbe9802500" />
- 步骤 5：功能验证
  - 命令：
  -     cd ~/cloud-final-project/src
  -     vim test.sh
  -     chmod +x test.sh
  - 参数解释：
  - curl -s http://localhost:9999/health: 静默模式访问健康检查
  - docker run -d --name test-container: 启动测试容器
  - docker stop test-container: 停止测试容器
  - docker rm test-container: 删除测试容器
  - 输出/结果（截图/日志）：
  - 
#### 6.3 关键配置文件（如有）
贴出核心配置片段并解释字段含义。
**Dockerfile.base文件**
<img width="865" height="217" alt="image" src="https://github.com/user-attachments/assets/2c1b5e1e-0bb3-4700-852e-863061b219a7" />
  - 1.FROM python:3.9：用 Python3.9 的环境当基础
  - 2.WORKDIR /app：容器里干活的目录定在/app
  - 3.COPY . .：把本地文件全复制到容器的/app里
  - 4.RUN pip install ...：装requirements.txt里的依赖（用阿里云源更快）
  - 5.EXPOSE 5000：说明容器用 5000 端口
  - 6.CMD [...]：容器启动时，运行app.py并绑定 5000 端口
 
**requirement.txt文件**
<img width="864" height="171" alt="image" src="https://github.com/user-attachments/assets/6e50201d-4369-4db9-bc4b-59334a2c6638" />
  - 1.Flask==2.3.3          # Python的轻量级Web框架（做Web应用的核心）
  - 2.gunicorn==21.2.0      # Python WSGI HTTP服务器（部署Flask应用用）
  - 3.requests==2.31.0      # 发送HTTP请求的库（比如调用外部接口）
  - 4.pytest==7.4.2         # Python的单元测试框架（写代码测试用）
---

### 7. 功能验证与结果展示

必须做到“可验证、可复现、可解释”。至少包含：

- **验证用例列表**（输入/操作 -> 预期 -> 实际结果）：
  - 用例1：环境准备验证
    - 输入/操作：运行./setup-env.sh
    - 预期结果：显示Docker版本信息，显示完整项目结构，显示6个环境变量
    - 实际结果：
      <img width="864" height="338" alt="image" src="https://github.com/user-attachments/assets/cdae8657-5de9-4bc9-b48f-f6feee34675b" />
      <img width="864" height="406" alt="image" src="https://github.com/user-attachments/assets/d5679960-ef5f-4cf9-9b8c-4100847a6fef" />
      <img width="865" height="360" alt="image" src="https://github.com/user-attachments/assets/ad6a85b2-60f0-459e-b3f8-36b1026e81f4" />
    - 分析：输出中的"✓"标志和成功信息说明环境准备成功

  - 用例2：API功能验证
    - 1.输入操作：curl http://localhost:8081/
    - 预期结果：JSON格式的项目信息
    - 实际结果：
      <img width="864" height="56" alt="image" src="https://github.com/user-attachments/assets/a4c2f9c9-4a17-43ce-ac78-0c77feefe912" />
    - 2.输入操作：curl http://localhost:8082/env
    - 预期结果：显示FLASK_ENV等变量
    - 实际结果：
      <img width="1233" height="72" alt="538a2952-80d7-4b33-a814-37651b8e1834" src="https://github.com/user-attachments/assets/58769a7e-6aed-4587-9e20-ee51f792b573" />
    - 3.输入操作：curl http://localhost:8083/info
    - 预期结果：显示容器内部信息
    - 实际结果：
      <img width="861" height="56" alt="image" src="https://github.com/user-attachments/assets/71368782-1510-4b88-ad32-b54e59e8f3ea" />
    - 4.输入操作：curl http://localhost:8081/healthy
    - 预期结果：{"status": "healthy"}
    - 实际结果：
      <img width="594" height="39" alt="image" src="https://github.com/user-attachments/assets/f821360c-fbc9-4d9b-aaf0-59ca16a7e629" />
    - 分析：返回JSON格式的健康状态，status字段为"healthy"，说明应用正常运行
  - 用例3：镜像构建验证
    - 输入/操作：运行./build.sh
    - 预期结果：成功构建三个镜像标签，显示大小对比
    - 实际结果：
      <img width="864" height="414" alt="image" src="https://github.com/user-attachments/assets/e08ec455-a918-4caf-ba25-1280e9e52905" />
    - 分析：镜像体积从1.11GB减少到65.5MB，优化率94.1%，证明多阶段构建有效
      
   - 用例4：容器运行验证
     - 输入/操作：运行./run.sh
     - 预期结果：三个容器正常运行，端口映射正确
     - 实际结果：
       <img width="875" height="313" alt="image" src="https://github.com/user-attachments/assets/38f4b773-7d09-4610-8c89-141b4be1eb1e" />
     - 分析："Up"状态和端口映射信息说明容器正常运行
       
- **关键截图/输出**：
  - 截图1：镜像大小对比结果
   <img width="568" height="151" alt="image" src="https://github.com/user-attachments/assets/c002c0be-03a1-401d-b6b5-18c488c9a9b8" />

  - 截图2：容器运行状态
 
  - 截图3：完整测试结果
    <img width="865" height="505" alt="image" src="https://github.com/user-attachments/assets/5c813f15-1b1b-4906-9f4f-00ffe54febc8" />
    <img width="865" height="401" alt="image" src="https://github.com/user-attachments/assets/ac15b4a5-e8ef-48cd-be59-332f0fc4b975" />
- **结果分析**：为什么能说明功能已达成？
- 1. 可验证性分析
  - 量化指标：镜像体积从895MB→158MB，有明确数字证明优化效果
  - 状态检查：所有容器状态为"Up"，端口映射正确显示
  - HTTP响应：每个端点返回正确的JSON格式数据，状态码均为200
- 2. 可复现性分析
  - 脚本化操作：所有步骤都有对应脚本（setup、build、run、test）
  - 环境明确：明确使用Ubuntu 22.04 + Docker 24.0.7 + Python 3.9
  - 依赖锁定：requirements.txt固定版本，避免依赖冲突
- 3. 可解释性分析
  - 技术原理：多阶段构建减少镜像层数和文件数量
  - 安全设计：非root用户、只读挂载、健康检查等安全措施
  - 优化策略：Alpine基础镜像、清理缓存、合并指令等优化方法
- 4.功能完整性验证
    <img width="894" height="488" alt="ed3949be8c3e30dcfd560d91f709c2b9" src="https://github.com/user-attachments/assets/8dd3d632-fab3-46db-8877-dbd838173d68" />

---

### 8. 运维与排错（必写）

至少记录 3 个真实问题或人工“故障注入”的问题，采用统一格式：

- **问题 1**
  - 现象：
  - 定位过程（命令/日志/对照项）：
  - 根因：
  - 解决方法：
  - 复盘与预防：

（问题 2、问题 3 同理）

---

### 9. 安全与合规说明（按需）

- 使用非root用户运行容器
- 敏感信息通过环境变量传递
- 配置最小权限原则
---

### 10. 小组分工与贡献说明（必写）

采用“任务-负责人-工作量/证据”的方式，避免泛泛而谈。

| 模块/任务 | 负责人 | 贡献说明（commit/截图/文档链接） |
|---|---|---|
| 项目实现 | 潘丽娜 |  |
| 实验报告 | 李梦君 |  |
| PPT+仓库提交 | 潘婉钰 |  |
| 答辩 | 王露 |  |

---

### 11. 总结与展望

**本次实验学到的 3 点（对应课程内容）**
- 1、 Docker容器化技术实践（对应课程模块：容器技术）
- 2、 环境一致性保障（对应课程模块：云环境部署）
- 3、 微服务架构基础（对应课程模块：微服务）

**当前不足**
- 1、缺少监控告警：只能通过健康检查了解基本状态，缺乏性能指标监控
- 2、无滚动更新：更新应用需要停止旧容器，无法实现零停机部署
- 3、配置管理简单：环境变量方式适合简单配置，复杂配置需改进
- 4、启动时间较长：首次启动需要下载基础镜像，未使用本地镜像仓库
- 5、密钥管理简单：敏感信息直接写在环境变量中，未使用Secrets管理
- 6、测试覆盖率有限：只有基础功能测试，缺乏性能测试和压力测试
  
**未来改进**
- 1、数据库集成：添加PostgreSQL容器，数据持久化，完整应用栈演示
- 2、消息队列：集成RabbitMQ或Redis，异步处理演示
- 3、启动加速：构建本地镜像仓库、使用镜像缓存，启动时间<5s
- 4、健康检查增强：添加就绪检查和存活检查，更精确的状态监控
- 5、密钥管理：使用Docker Secrets或HashiCorp Vault，敏感信息加密存储
- 6、日志收集：ELK Stack (Elasticsearch, Logstash, Kibana)，集中日志分析

---

### 12. 附录

#### 12.1 资源清单（可选）

- 镜像/ISO/容器镜像来源：
- 参考资料（不少于 3 条，注明标题与来源）：

#### 12.2 一键复现（可选但加分）

如提供脚本/Makefile/README 步骤，请在此说明入口与用法。
-     git clone <repo>
-     cd ~/cloud-final-project
-     ./start-all.sh

